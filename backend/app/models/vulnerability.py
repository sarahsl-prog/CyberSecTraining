"""Vulnerability model for detected security issues."""

from sqlalchemy import Column, String, DateTime, ForeignKey
from sqlalchemy.orm import relationship

from app.models.base import Base, IdMixin, TimestampMixin


class Vulnerability(Base, IdMixin, TimestampMixin):
    """Represents a detected vulnerability on a device."""

    __tablename__ = "vulnerabilities"

    device_id = Column(String(36), ForeignKey("devices.id"), nullable=False, index=True)
    vuln_type = Column(String(100), nullable=False)  # e.g., "default_credentials", "open_telnet"
    severity = Column(String(20), nullable=False)  # critical, high, medium, low
    discovered_at = Column(DateTime, nullable=False)
    fixed_at = Column(DateTime, nullable=True)

    # Additional metadata
    title = Column(String(255), nullable=True)
    description = Column(String(2000), nullable=True)
    cve_id = Column(String(50), nullable=True)  # CVE identifier if applicable
    affected_service = Column(String(100), nullable=True)
    affected_port = Column(String(10), nullable=True)

    # Relationships
    device = relationship("Device", back_populates="vulnerabilities")

    def __repr__(self) -> str:
        return f"<Vulnerability(id={self.id}, type={self.vuln_type}, severity={self.severity})>"
