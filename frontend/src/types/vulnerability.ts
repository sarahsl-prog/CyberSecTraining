/**
 * Vulnerability-related types.
 *
 * These types define the data structures for vulnerabilities
 * detected during network scans.
 */

import type { PaginatedResponse } from './api';

/**
 * Vulnerability severity levels.
 * Ordered from most to least severe.
 */
export type SeverityLevel = 'critical' | 'high' | 'medium' | 'low' | 'info';

/**
 * All severity levels in order of severity.
 */
export const SEVERITY_LEVELS: SeverityLevel[] = [
  'critical',
  'high',
  'medium',
  'low',
  'info',
];

/**
 * Severity level display configuration.
 */
export const SEVERITY_CONFIG: Record<SeverityLevel, {
  label: string;
  color: string;
  cssVar: string;
}> = {
  critical: {
    label: 'Critical',
    color: '#dc2626',
    cssVar: 'var(--color-severity-critical)',
  },
  high: {
    label: 'High',
    color: '#ea580c',
    cssVar: 'var(--color-severity-high)',
  },
  medium: {
    label: 'Medium',
    color: '#ca8a04',
    cssVar: 'var(--color-severity-medium)',
  },
  low: {
    label: 'Low',
    color: '#16a34a',
    cssVar: 'var(--color-severity-low)',
  },
  info: {
    label: 'Info',
    color: '#2563eb',
    cssVar: 'var(--color-info)',
  },
};

/**
 * Complete vulnerability information.
 */
export interface Vulnerability {
  /** Unique vulnerability identifier */
  id: string;
  /** ID of the affected device */
  device_id: string;
  /** Vulnerability type identifier (e.g., 'default_credentials') */
  vuln_type: string;
  /** Severity level */
  severity: SeverityLevel;
  /** Human-readable title */
  title?: string;
  /** Detailed description */
  description?: string;
  /** CVE identifier if applicable */
  cve_id?: string;
  /** Affected service name */
  affected_service?: string;
  /** Affected port number */
  affected_port?: string;
  /** Remediation steps */
  remediation?: string;
  /** Whether the vulnerability has been fixed */
  is_fixed: boolean;
  /** Whether the fix was verified by re-scan */
  verified_fixed: boolean;
  /** Discovery timestamp (ISO 8601) */
  discovered_at?: string;
  /** Fix timestamp (ISO 8601) */
  fixed_at?: string;
  /** Record creation timestamp */
  created_at?: string;
  /** Last update timestamp */
  updated_at?: string;
}

/**
 * Payload for updating a vulnerability.
 */
export interface VulnerabilityUpdate {
  /** Updated title */
  title?: string;
  /** Updated description */
  description?: string;
  /** Updated remediation steps */
  remediation?: string;
  /** Fix status */
  is_fixed?: boolean;
}

/**
 * Payload for marking a vulnerability as fixed.
 */
export interface VulnerabilityMarkFixed {
  /** Whether the vulnerability is fixed */
  is_fixed: boolean;
  /** Whether the fix was verified by re-scan */
  verified?: boolean;
}

/**
 * Paginated vulnerability list response.
 */
export type VulnerabilityListResponse = PaginatedResponse<Vulnerability>;

/**
 * Vulnerability summary statistics.
 * Used for dashboard widgets and overview displays.
 */
export interface VulnerabilitySummary {
  /** Total number of vulnerabilities */
  total: number;
  /** Critical severity count */
  critical: number;
  /** High severity count */
  high: number;
  /** Medium severity count */
  medium: number;
  /** Low severity count */
  low: number;
  /** Info severity count */
  info: number;
  /** Fixed vulnerabilities count */
  fixed: number;
  /** Unfixed vulnerabilities count */
  unfixed: number;
}

/**
 * Filter options for vulnerability list queries.
 */
export interface VulnerabilityFilters {
  /** Filter by device ID */
  device_id?: string;
  /** Filter by severity level */
  severity?: SeverityLevel;
  /** Filter by vulnerability type */
  vuln_type?: string;
  /** Filter by fix status */
  is_fixed?: boolean;
  /** Search in title/description */
  search?: string;
}

/**
 * Common vulnerability types.
 */
export const VULNERABILITY_TYPES = [
  'default_credentials',
  'open_telnet',
  'open_ftp',
  'open_snmp',
  'unencrypted_http',
  'upnp_enabled',
  'open_smb',
  'open_database',
  'open_rdp',
  'open_vnc',
  'weak_wifi',
  'outdated_firmware',
  'unnecessary_services',
] as const;

export type VulnerabilityType = typeof VULNERABILITY_TYPES[number];
